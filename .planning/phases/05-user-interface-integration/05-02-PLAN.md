---
phase: 05-user-interface-integration
plan: 02
type: execute
wave: 2
depends_on: [05-01]
files_modified: [ui/views/scanning.py]
autonomous: true
requirements: [UI-02, UI-03]
---

<objective>
Implement the Scanning & Carving page and integrate backend recovery modules using background threading for real-time UI updates.

Purpose: Main data acquisition interface for the recovery dashboard.
Output: Page showing real-time fragment detection and log activity.
</objective>

<execution_context>
@C:/Users/devid/.gemini/get-shit-done/workflows/execute-plan.md
@C:/Users/devid/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-01-SUMMARY.md
@.planning/phases/05-CONTEXT.md
@.planning/phases/05-user-interface-integration/05-RESEARCH.md
@carving/hybrid.py
@storage_scan/scanner.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scanning Page UI Implementation</name>
  <files>ui/views/scanning.py</files>
  <action>
    1. Implement the Scanning & Carving page:
       - Header: "Disk Scanning & Data Carving".
       - Overall Progress bar (`st.progress`).
       - Status group (`st.status`) for showing current operation (e.g., "Scanning sector 1024...").
       - Live Log Feed section displaying `st.session_state.logs` using `ui/components/logger.py`.
       - Fragment Grid (`st.dataframe`) showing identified fragments (Type, Offset, Confidence, Size).
       - "Start Scan" and "Stop Scan" buttons.
  </action>
  <verify>
    <automated>python -m streamlit run ui/app.py --server.headless true</automated>
    <manual>Check Scanning & Carving page layout.</manual>
    <sampling_rate>run after this task commits</sampling_rate>
  </verify>
  <done>UI for scanning and progress tracking is built.</done>
</task>

<task type="auto">
  <name>Task 2: Backend Integration & Background Worker</name>
  <files>ui/views/scanning.py</files>
  <action>
    1. Implement background thread logic to run `HybridCarver`. Use `threading.Thread` and `add_script_run_ctx` from `streamlit.runtime.scriptrunner`.
    2. Define a worker function that:
       - Initializes `StorageScanner` and `HybridCarver` with paths from `st.session_state`.
       - Emits log events and fragment findings to a `queue.Queue`.
    3. Implement a `while` loop in the main UI script that polls the queue and updates `st.session_state.carved_fragments` and `st.session_state.logs`.
    4. Ensure the UI remains responsive and updates in real-time as the carver finds fragments.
  </action>
  <verify>
    <automated>python -m streamlit run ui/app.py --server.headless true</automated>
    <manual>Start a scan and verify logs and fragments update live. Use a dummy image if necessary.</manual>
    <sampling_rate>run after this task commits</sampling_rate>
  </verify>
  <done>HybridCarver runs in the background and populates the UI state in real-time.</done>
</task>

</tasks>

<verification>
Check that a scan can be started, it doesn't lock the UI, logs appear as they occur, and fragments populate the grid.
</verification>

<success_criteria>
- "Start Scan" button triggers a background thread.
- `st.progress` updates as the disk is scanned.
- `st.dataframe` reflects the current list of `carved_fragments`.
- Logs are visible and scrolling in real-time.
</success_criteria>

<output>
After completion, create `.planning/phases/05-user-interface-integration/05-02-SUMMARY.md`
</output>
