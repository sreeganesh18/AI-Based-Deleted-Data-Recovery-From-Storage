---
phase: 05-user-interface-integration
plan: 03
type: execute
wave: 3
depends_on: [05-02]
files_modified: [ui/views/review.py, ui/views/export.py]
autonomous: true
requirements: [UI-02, UI-03, UI-04]
---

<objective>
Implement the Review & Reassemble page for file analysis and the Export page for finalized data recovery.

Purpose: Final stage of the recovery process where users evaluate and save recovered data.
Output: Integrated review dashboard with image comparison and hex inspection, and an export utility.
</objective>

<execution_context>
@C:/Users/devid/.gemini/get-shit-done/workflows/execute-plan.md
@C:/Users/devid/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-02-SUMMARY.md
@.planning/phases/05-CONTEXT.md
@.planning/phases/05-user-interface-integration/05-RESEARCH.md
@reconstruction/grouping.py
@reconstruction/denoise.py
@reconstruction/enhancement.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Review & Reassemble Page Implementation</name>
  <files>ui/views/review.py</files>
  <action>
    1. Implement the Review & Reassemble page:
       - Sidebar or Left column: List of `reconstructed_files` with basic metadata.
       - Center Column (Detail View):
         - "Quality Comparison" using `streamlit-image-comparison` to show Original vs. Denoised/Enhanced images.
         - Tabs for "Metadata", "Fragment Sequence", and "Raw Data (Hex)".
         - "Metadata" tab: Show file size, MD5, reassembly strategy, and confidence.
         - "Fragment Sequence" tab: Show a sequential list of fragments within the file.
         - "Raw Data (Hex)" tab: Use `ui/components/hex_viewer.py` to inspect the reassembled binary.
       - Integrated logic to run `FragmentGrouper`, `DenoisingPipeline`, and `StructuralRepair` on fragments in `st.session_state.carved_fragments`.
       - "Orphan Fragments" section/tab for manually identifying fragments that weren't reassembled.
  </action>
  <verify>
    <automated>python -m streamlit run ui/app.py --server.headless true</automated>
    <manual>Check Review & Reassemble page layout and interactive components.</manual>
    <sampling_rate>run after this task commits</sampling_rate>
  </verify>
  <done>Interactive review dashboard for reassembled files is functional.</done>
</task>

<task type="auto">
  <name>Task 2: Export Page & Final Collision Handling</name>
  <files>ui/views/export.py</files>
  <action>
    1. Implement the Export page:
       - Multi-select list (`st.multiselect`) for files to export from `st.session_state.reconstructed_files`.
       - Export Directory input (`st.text_input`).
       - "Export Selected Files" button.
       - Logic for writing files to the destination.
       - Implement **Auto-Suffixing** for collision handling (e.g., `file_1.recovered`, `file_2.recovered`) as per 05-CONTEXT.md.
       - Show a summary status message (e.g., "Successfully exported 5 files to D:/recovery_results").
  </action>
  <verify>
    <automated>python -m streamlit run ui/app.py --server.headless true</automated>
    <manual>Select files, set a destination, and export. Check destination for files and suffixing if collisions occur.</manual>
    <sampling_rate>run after this task commits</sampling_rate>
  </verify>
  <done>User can manually select and export recovered files with collision management.</done>
</task>

<task type="auto">
  <name>Task 3: Final Integrated Dashboard Validation</name>
  <files>ui/app.py</files>
  <action>
    1. Perform a full E2E run using the dashboard:
       - Start app, configure session.
       - Run scan and carve fragments.
       - Review reassembled images with the slider.
       - Export files.
    2. Fix any UI/integration bugs found.
    3. Update `main.py` if necessary to point to the Streamlit entry point.
  </action>
  <verify>
    <automated>python -m streamlit run ui/app.py --server.headless true</automated>
    <manual>Complete a full recovery cycle in the UI and verify success.</manual>
    <sampling_rate>run after this task commits</sampling_rate>
  </verify>
  <done>The integrated recovery dashboard is fully validated and functional.</done>
</task>

</tasks>

<verification>
Check that the full recovery pipeline can be executed via the UI, from initial configuration to final export.
</verification>

<success_criteria>
- Review page displays image comparison correctly.
- Hex viewer works for reassembled files.
- Export functionality correctly handles multiple files and filename collisions.
- Full E2E recovery session works without crashes.
</success_criteria>

<output>
After completion, create `.planning/phases/05-user-interface-integration/05-03-SUMMARY.md`
</output>
