---
phase: 03-carving-denoising
plan: 02
type: execute
wave: 2
depends_on: [03-01-PLAN.md]
files_modified: [carving/hybrid.py, reconstruction/denoise.py]
autonomous: true
requirements: [PH3-04, PH3-05]
must_haves:
  truths:
    - "HybridCarver prioritizes signatures over AI classifier."
    - "Low confidence classifications (< 0.7) are handled appropriately (skipped/flagged)."
    - "Denoising pipeline applies Autoencoder to identified fragments."
    - "Denoised fragments are stored separately from originals."
  artifacts:
    - path: "carving/hybrid.py"
      provides: "HybridCarver class integrating signatures and AI"
    - path: "reconstruction/denoise.py"
      provides: "DenoisingPipeline class for batch fragment cleaning"
---

<objective>
Implement the hybrid carving logic and denoising pipeline to integrate AI models into the recovery process.
Purpose: Combine traditional forensic techniques with AI-driven classification and denoising for enhanced data recovery.
Output: Functional HybridCarver and DenoisingPipeline modules.
</objective>

<execution_context>
@C:/Users/devid/.gemini/get-shit-done/workflows/execute-plan.md
@C:/Users/devid/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/03-CONTEXT.md
@carving/signature.py
@models/classifier.py
@models/autoencoder.py
@models/checkpoints/classifier_best.pth
@models/checkpoints/autoencoder_best.pth
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement HybridCarver</name>
  <files>carving/hybrid.py</files>
  <action>
    - Create `carving/hybrid.py` defining `HybridCarver`.
    - Integrate `SignatureCarver` for primary identification.
    - Load `FragmentClassifier` and implement a fallback mechanism when signatures are not found.
    - Implement the 0.7 confidence threshold and "skipped/flagged" behavior for low-confidence blocks.
    - Ensure it returns a mapping of block offsets to identified file types.
  </action>
  <verify>
    <automated>pytest tests/test_carver.py</automated>
  </verify>
  <done>HybridCarver correctly prioritizes signatures and uses AI for fallback with confidence thresholds.</done>
</task>

<task type="auto">
  <name>Task 2: Implement DenoisingPipeline</name>
  <files>reconstruction/denoise.py</files>
  <action>
    - Create `reconstruction/denoise.py` defining `DenoisingPipeline`.
    - Load the `FragmentAutoencoder` from checkpoints.
    - Implement a `process_fragments` method that cleans a batch of fragments.
    - Ensure denoised fragments are stored in a dedicated directory (e.g., `dataset/fragments/denoised/`) to avoid overwriting originals.
  </action>
  <verify>
    <automated>python reconstruction/denoise.py --test</automated>
  </verify>
  <done>DenoisingPipeline successfully cleans fragments and stores them in separate storage.</done>
</task>

</tasks>

<verification>
Check that `HybridCarver` can identify dummy JPEG/PDF fragments.
Verify `DenoisingPipeline` output exists and is distinct from original fragments.
</verification>

<success_criteria>
- Signatures take precedence in HybridCarver.
- Classifier is used as fallback with > 0.7 confidence.
- Autoencoder is applied to all identified fragments.
- No original fragments are overwritten.
</success_criteria>

<output>
After completion, create `.planning/phases/03-carving-denoising/03-02-SUMMARY.md`
</output>
