---
phase: 02-models
plan: 02
type: execute
wave: 2
depends_on: [01]
files_modified: [models/classifier.py, scripts/train_classifier.py, tests/test_classifier.py]
autonomous: true
requirements: [CLF-01, TRAIN-01]

must_haves:
  truths:
    - "Classifier architecture uses 1D-CNN layers"
    - "Training script produces a saved model checkpoint (.pth)"
    - "Model achieves >80% accuracy on dummy balanced fragment dataset"
  artifacts:
    - path: "models/classifier.py"
      provides: "FragmentClassifier class"
    - path: "scripts/train_classifier.py"
      provides: "CLI to train the classifier"
  key_links:
    - from: "models/classifier.py"
      to: "dataset/loader.py"
      via: "data feeding"
    - from: "scripts/train_classifier.py"
      to: "utils/training.py"
      via: "training management"
---

<objective>
Implement the 1D-CNN architecture for fragment classification and the corresponding training script.

Purpose: Accurately identify file types (JPEG, PDF) from 512-byte fragments.
Output: FragmentClassifier model and train_classifier.py script.
</objective>

<tasks>

<task type="auto">
  <name>Task 1: Implement 1D-CNN Classifier Architecture</name>
  <files>models/classifier.py, tests/test_classifier.py</files>
  <action>
    Refactor `models/classifier.py` with a 1D-CNN architecture.
    - Input: (1, 512) tensor.
    - 3x Conv1D layers (e.g., 32, 64, 128 filters) with ReLU and BatchNorm.
    - MaxPooling1D after conv layers.
    - 2x Fully Connected layers (e.g., 256, 3 classes).
    - Implement `forward` pass with Softmax.
    - Create `tests/test_classifier.py` to verify model output shape and parameter count.
  </action>
  <verify>pytest tests/test_classifier.py</verify>
  <done>Classifier model produces (1, 3) logits/probs for a (1, 512) input.</done>
</task>

<task type="auto">
  <name>Task 2: Create Classifier Training Script</name>
  <files>scripts/train_classifier.py</files>
  <action>
    Implement `scripts/train_classifier.py`.
    - Use `argparse` for hyperparameters (lr, epochs, batch_size, data_dir).
    - Instantiate `FragmentDataset`, `DataLoader`, `FragmentClassifier`, and `Trainer`.
    - Run the training loop and save the best model to `models/checkpoints/classifier_best.pth`.
    - Log accuracy and loss to console/tensorboard.
  </action>
  <verify>python scripts/train_classifier.py --epochs 1 --batch-size 4 --data-dir dataset/fragments/ (with dummy data)</verify>
  <done>Training script executes and saves a .pth checkpoint.</done>
</task>

</tasks>

<success_criteria>
- `FragmentClassifier` handles 512-byte fragment inputs.
- `train_classifier.py` runs through at least one epoch without error.
- Best model is saved to the checkpoints directory.
</success_criteria>
